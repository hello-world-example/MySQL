<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Innodb Lock Wait Timeout | MySQL</title>


<link rel="stylesheet" href="/MySQL/book.min.a2277534155c5e81ce2c8ca6a4cd295525f25c75788a2e4e72c3310491c743b1.css">




<link rel="icon" href="/MySQL/favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://hello-world-example.github.io/MySQL/">MySQL</a>
</h2>






    
  
  
  

  <style>
  nav ul a[href$="\2fMySQL\2f docs\2f Better\2finnodb_lock_wait_timeout\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li><strong>Install</strong>
<ul>
<li><a href="/MySQL/docs/Install/Mac-Multiple-Instance/">MAC å¤šå®ä¾‹å®‰è£… å’Œ ä¸»ä»é…ç½®</a></li>
<li><a href="/MySQL/docs/Install/Docker-Multiple-Instance/">ä½¿ç”¨ Docker æ­å»ºä¸»ä»æµ‹è¯•</a></li>
</ul>
</li>
<li><strong>JDBC</strong>
<ul>
<li><a href="/MySQL/docs/Jdbc/FetchSize/">FetchSize å¤„ç†å¤§ç»“æœé›†</a></li>
<li><a href="/MySQL/docs/Jdbc/DataSource/">DataSource é…ç½®</a></li>
</ul>
</li>
<li><strong>Better</strong>
<ul>
<li><a href="/MySQL/docs/Better/innodb_lock_wait_timeout/">é”ç­‰å¾…æ—¶é—´</a></li>
</ul>
</li>
<li><strong>Binlog</strong>
<ul>
<li><a href="/MySQL/docs/Binlog/Quick-Start/">å¿«é€Ÿå…¥é—¨</a></li>
<li><a href="/MySQL/docs/Binlog/Gtid/">GTID</a></li>
<li><a href="/MySQL/docs/Binlog/binlog-protocol/">_binlog åè®®</a></li>
<li><a href="/MySQL/docs/Binlog/parse-binlog-by-java/">_Java è§£æ binlog</a></li>
<li><a href="/MySQL/docs/Binlog/parse-binlog-by-canal/">_Canal è®¢é˜… binlog</a></li>
</ul>
</li>
<li><strong>Canal</strong>
<ul>
<li><a href="/MySQL/docs/canal/introduce/">Canal ç®€ä»‹</a></li>
<li><a href="/MySQL/docs/canal/data-type/">æ•°æ®æ ¼å¼</a></li>
</ul>
</li>
<li><strong>å…¶ä»–</strong>
<ul>
<li><a href="/MySQL/docs/rds_dbsync/">MySQL å…¨é‡åŒæ­¥ Postgres</a></li>
</ul>
</li>
</ul>







</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/MySQL/svg/menu.svg" alt="Menu" />
  </label>
  <strong>Innodb Lock Wait Timeout</strong>
</header>

      
<article class="markdown"><h1 id="é”ç­‰å¾…è¶…æ—¶">é”ç­‰å¾…è¶…æ—¶</h1>
<h3 id="é”è¶…æ—¶lock-wait-timeout-å’Œ-æ­»é”dead-lock">é”è¶…æ—¶(Lock wait timeout) å’Œ æ­»é”(Dead Lock)</h3>
<ul>
<li><strong>Lock wait timeout</strong>
<ul>
<li>åé¢çš„äº‹åŠ¡ç­‰å¾…å‰é¢å¤„ç†çš„äº‹åŠ¡é‡Šæ”¾é”ï¼Œç­‰å¾…æ—¶é—´è¶…è¿‡äº†<code>innodb_lock_wait_timeout</code></li>
<li>åœ¨è¶…æ—¶æ—¶é—´å†…ï¼Œåæ¥çš„äº‹åŠ¡ä¼šä¸€ç›´ç­‰å¾…å‰é¢çš„äº‹åŠ¡é‡Šæ”¾é”ï¼Œä¼šå¯¼è‡´ç¨‹åºé˜»å¡</li>
<li><strong>å½“å‘ç”Ÿé”ç­‰å¾…è¶…æ—¶æ—¶ï¼Œå°†å›æ»šå½“å‰è¯­å¥ï¼ˆè€Œä¸æ˜¯æ•´ä¸ªäº‹åŠ¡ï¼‰</strong></li>
<li><code>ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</code> å¼‚å¸¸</li>
<li><strong>å‡ºç°çš„åŸå› ï¼š</strong> äº‹åŠ¡è¿‡å¤§ï¼Œé”å ç”¨çš„æ—¶é—´è¿‡é•¿</li>
</ul>
</li>
<li><strong>Dead Lock</strong> æ­»é”
<ul>
<li>ä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾ç›¸åŒèµ„æºçš„é”</li>
<li>æ­»é”äº§ç”Ÿåä¼šç«‹å³å¤±è´¥ï¼Œéšæœºå›æ»šå…¶ä¸­ä¸€ä¸ªäº‹åŠ¡ï¼ˆåæ“ä½œé€ æˆæ­»é”çš„äº‹åŠ¡ï¼‰</li>
<li>å½“ <code>innodb_deadlock_detect</code> è¢«ç¦ç”¨æ—¶ï¼Œæ­»é”çš„è¶…æ—¶æ—¶é—´å³ <code>innodb_lock_wait_timeout</code></li>
<li><code>ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</code></li>
<li><strong>å‡ºç°çš„åŸå› ï¼š</strong> å¤šä¸ªäº‹åŠ¡å¯¹åŒä¸€æ‰¹æ•°æ®è¿›è¡Œæ“ä½œæ—¶ï¼ŒåŠ é”é¡ºåºä¸ä¸€è‡´</li>
</ul>
</li>
</ul>
<h3 id="innodb_lock_wait_timeout-å’Œ-lock_wait_timeout">innodb_lock_wait_timeout å’Œ lock_wait_timeout</h3>
<blockquote>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/server-system-variable-reference.html">Server System Variable Reference</a>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_lock_wait_timeout">innodb_lock_wait_timeout</a></li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_lock_wait_timeout">lock_wait_timeout</a></li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li><code>innodb_lock_wait_timeout</code>
<ul>
<li>é’ˆå¯¹è¡Œçº§é”ï¼Œä¸é€‚ç”¨ä¸è¡¨é”</li>
<li>å•ä½ç§’ï¼Œé»˜è®¤ <code>50</code>ï¼Œå¯é€‰å€¼ 1 ~ 1073741824</li>
<li>å¯¹äºé«˜åº¦äº¤äº’çš„åº”ç”¨ç¨‹åº æˆ– <strong>OLTPç³»ç»Ÿï¼Œå¯èƒ½ä¼šé™ä½æ­¤å€¼ï¼Œä»¥ä¾¿å¿«é€Ÿå“åº”ç”¨æˆ·åé¦ˆ</strong></li>
<li>å¯¹äºç­‰å¾…å…¶ä»–å¤§å‹æ’å…¥æˆ–æ›´æ–°æ“ä½œå®Œæˆçš„æ•°æ®ä»“åº“ï¼Œå¯ä»¥å¢åŠ æ­¤å€¼</li>
</ul>
</li>
<li><code>lock_wait_timeout</code>
<ul>
<li>DDL å’Œ DML å¯¹ è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•° çš„æ“ä½œ</li>
<li>å¸¸è§å¦‚è¡¨é”ç­‰</li>
<li>å•ä½ç§’ï¼Œé»˜è®¤ 31536000 (1å¹´)ï¼Œå¯é€‰å€¼ 1 ~ 31536000</li>
</ul>
</li>
</ul>
<h3 id="ä¿®æ”¹-innodb_lock_wait_timeout">ä¿®æ”¹ innodb_lock_wait_timeout</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># é”è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 5s
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> session innodb_lock_wait_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%lock_wait_timeout%&#39;</span>;
<span style="color:#f92672">+--------------------------+----------+</span>
<span style="color:#f92672">|</span> Variable_name            <span style="color:#f92672">|</span> Value    <span style="color:#f92672">|</span>
<span style="color:#f92672">+--------------------------+----------+</span>
<span style="color:#f92672">|</span> innodb_lock_wait_timeout <span style="color:#f92672">|</span> <span style="color:#ae81ff">5</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> lock_wait_timeout        <span style="color:#f92672">|</span> <span style="color:#ae81ff">31536000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+--------------------------+----------+</span>
</code></pre></div><h2 id="æµ‹è¯•åœºæ™¯">æµ‹è¯•åœºæ™¯</h2>
<h3 id="æ•°æ®å‡†å¤‡">æ•°æ®å‡†å¤‡</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- åˆ›å»ºæµ‹è¯•è¡¨
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>T_TEST<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>ID<span style="color:#f92672">`</span> <span style="color:#66d9ef">bigint</span>(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">AUTO_INCREMENT</span>,
  <span style="color:#f92672">`</span>UNIQ<span style="color:#f92672">`</span> <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>NAME<span style="color:#f92672">`</span> <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>ID<span style="color:#f92672">`</span>),
  <span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>UNIQ_FILED_UNIQ<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>UNIQ<span style="color:#f92672">`</span>) <span style="color:#66d9ef">USING</span> BTREE
) <span style="color:#66d9ef">ENGINE</span><span style="color:#f92672">=</span>InnoDB;

<span style="color:#75715e">-- æ’å…¥æµ‹è¯•æ•°æ®
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#f92672">`</span>T_TEST<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>ID<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>UNIQ<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>NAME<span style="color:#f92672">`</span>) <span style="color:#66d9ef">values</span> ( <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;Kail1&#39;</span>, <span style="color:#e6db74">&#39;Kail1&#39;</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#f92672">`</span>T_TEST<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>ID<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>UNIQ<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>NAME<span style="color:#f92672">`</span>) <span style="color:#66d9ef">values</span> ( <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;Kail2&#39;</span>, <span style="color:#e6db74">&#39;Kail2&#39;</span>);
</code></pre></div><h3 id="ä¿®æ”¹éš”ç¦»çº§åˆ«">ä¿®æ”¹éš”ç¦»çº§åˆ«</h3>
<p>MySQL é»˜è®¤çš„éš”ç¦»çº§åˆ«æ˜¯ <strong>å¯é‡å¤è¯»</strong>ï¼ˆ<code>REPEATABLE-READ</code>ï¼‰ï¼Œä¸ºäº†å’Œå…¬å¸è®¾ç½®ä¿æŒä¸€è‡´ï¼Œè¿™é‡Œæ”¹ä¸º <strong>è¯»æäº¤</strong>ï¼ˆ<code>READ-COMMITTED</code>ï¼‰</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- select @@global.tx_isolation,@@tx_isolation; ä¹Ÿå¯ä»¥
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">@@</span>global.transaction_isolation,<span style="color:#f92672">@@</span>transaction_isolation;
<span style="color:#f92672">+--------------------------------+-------------------------+</span>
<span style="color:#f92672">|</span> <span style="color:#f92672">@@</span>global.transaction_isolation <span style="color:#f92672">|</span> <span style="color:#f92672">@@</span>transaction_isolation <span style="color:#f92672">|</span>
<span style="color:#f92672">+--------------------------------+-------------------------+</span>
<span style="color:#f92672">|</span> REPEATABLE<span style="color:#f92672">-</span><span style="color:#66d9ef">READ</span>                <span style="color:#f92672">|</span> REPEATABLE<span style="color:#f92672">-</span><span style="color:#66d9ef">READ</span>         <span style="color:#f92672">|</span>
<span style="color:#f92672">+--------------------------------+-------------------------+</span>

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> session variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%tx%&#39;</span>;
<span style="color:#f92672">+---------------+-----------------+</span>
<span style="color:#f92672">|</span> Variable_name <span style="color:#f92672">|</span> Value           <span style="color:#f92672">|</span>
<span style="color:#f92672">+---------------+-----------------+</span>
<span style="color:#f92672">|</span> tx_isolation  <span style="color:#f92672">|</span> REPEATABLE<span style="color:#f92672">-</span><span style="color:#66d9ef">READ</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> tx_read_only  <span style="color:#f92672">|</span> OFF             <span style="color:#f92672">|</span>
<span style="color:#f92672">+---------------+-----------------+</span>

<span style="color:#75715e">-- è®¾ç½® Session çº§åˆ«çš„éš”ç¦»çº§åˆ«ï¼Œç”¨äºæµ‹è¯•ï¼ˆè®¾ç½®çš„æ—¶å€™ READ COMMITTED ä¸­é—´æ²¡æœ‰æ¨ªå²—ï¼‰
</span><span style="color:#75715e">-- å…¨å±€çº§åˆ« SET GLOBAL TRANSACTION ISOLATION LEVEL xxx;
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SET</span> SESSION TRANSACTION ISOLATION LEVEL <span style="color:#66d9ef">READ</span> COMMITTED;
</code></pre></div><h3 id="äº‹åŠ¡æäº¤æ–¹å¼">äº‹åŠ¡æäº¤æ–¹å¼</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> session autocommit<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
  
<span style="color:#75715e">-- å…³é—­è‡ªåŠ¨æäº¤
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> session variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;autocommit&#39;</span>;
<span style="color:#f92672">+---------------+-------+</span>
<span style="color:#f92672">|</span> Variable_name <span style="color:#f92672">|</span> Value <span style="color:#f92672">|</span>
<span style="color:#f92672">+---------------+-------+</span>
<span style="color:#f92672">|</span> autocommit    <span style="color:#f92672">|</span> OFF   <span style="color:#f92672">|</span>
<span style="color:#f92672">+---------------+-------+</span>
</code></pre></div><h3 id="æµ‹è¯•å‰æ">æµ‹è¯•å‰æ</h3>
<ul>
<li>éœ€è¦åˆ†åˆ«å¼€å¯ä¸¤ä¸ªä¼šè¯ï¼Œåˆ›é€ å¤šäº‹åŠ¡ç¯å¢ƒ</li>
<li>å…³é—­äº‹åŠ¡è‡ªåŠ¨æäº¤ï¼Œé€šè¿‡ <code>commit</code> è‡ªåŠ¨æäº¤</li>
</ul>
<h3 id="åœºæ™¯æ­»é”-ç«‹å³å¤±è´¥">åœºæ™¯ï¼šæ­»é” ç«‹å³å¤±è´¥</h3>
<ul>
<li><code>ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</code></li>
<li>è¡¨ä¸­åˆ†åˆ«æœ‰ä¸¤è¡Œæ•°æ®</li>
<li>äº‹åŠ¡1 å…ˆæ›´æ–° 1 åæ›´æ–° 2ï¼Œäº‹åŠ¡2 å…ˆæ›´æ–° 2 åæ›´æ–° 1ï¼Œä»¥æ­¤æ¥åˆ›é€ æ­»é”</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- ğŸ˜€ äº‹åŠ¡1ï¼š æ“ä½œç¬¬ä¸€æ¡æ•°æ®ï¼Œ å¯¹ç¬¬ä¸€æ¡æ•°æ®åŠ é”
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx111&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
<span style="color:#75715e">-- â˜ ï¸ äº‹åŠ¡2ï¼š æ“ä½œç¬¬äºŒæ¡æ•°æ®ï¼Œ å¯¹ç¬¬äºŒæ¡æ•°æ®åŠ é”
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx222&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)


<span style="color:#75715e">-- ğŸ˜€ äº‹åŠ¡1ï¼šç¬¬2æ¡æ•°æ®å·²ç»è¢« äº‹åŠ¡2 å ç”¨ï¼Œè¿™é‡Œä¸ä¼šç«‹å³è¿”å›ï¼Œâ¤â¤ é˜»å¡ç­‰å¾… â¤â¤
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx111&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
<span style="color:#75715e">-- â˜ ï¸â˜ ï¸â˜ ï¸â˜ ï¸ äº‹åŠ¡2ï¼šç¬¬1æ¡æ•°æ®å·²ç»è¢« äº‹åŠ¡1 å ç”¨ï¼Œè¿™é‡Œæ£€æŸ¥åˆ°æ­»é”ï¼Œâ¤â¤ ç«‹å³æŠ¥é”™ â¤â¤ â˜ ï¸â˜ ï¸â˜ ï¸â˜ ï¸
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx222&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
ERROR <span style="color:#ae81ff">1213</span> (<span style="color:#ae81ff">40001</span>): Deadlock found <span style="color:#66d9ef">when</span> trying <span style="color:#66d9ef">to</span> get <span style="color:#66d9ef">lock</span>; try restarting transaction
<span style="color:#75715e">-- ğŸ˜€ äº‹åŠ¡1ï¼ˆç¬¬ä¸€ä¸ªä¼šè¯çª—å£ï¼‰ï¼šè§£é™¤é˜»å¡ï¼Œè¾“å‡ºå½±å“çš„è¡Œæ•°
</span><span style="color:#75715e"></span>Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">14</span>.<span style="color:#ae81ff">25</span> sec)


<span style="color:#75715e">-- ğŸ˜€ ä¼šè¯çª—å£1
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> commit;
<span style="color:#75715e">-- â˜ ï¸ ä¼šè¯çª—å£2
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> commit;


<span style="color:#75715e">-- æŸ¥è¯¢ç»“æœï¼Œå› ä¸ºäº‹åŠ¡äºŒè¢«å›æ»šï¼Œç»“æœä¸ºäº‹åŠ¡1 çš„æ›´æ–°ç»“æœ
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> T_TEST;
<span style="color:#f92672">+----+-------+-------+</span>
<span style="color:#f92672">|</span> ID <span style="color:#f92672">|</span> UNIQ  <span style="color:#f92672">|</span> NAME  <span style="color:#f92672">|</span>
<span style="color:#f92672">+----+-------+-------+</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> Kail1 <span style="color:#f92672">|</span> tx111 <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> Kail2 <span style="color:#f92672">|</span> tx111 <span style="color:#f92672">|</span>
<span style="color:#f92672">+----+-------+-------+</span>
</code></pre></div><h3 id="åœºæ™¯é”è¶…æ—¶-é˜»å¡ç­‰å¾…">åœºæ™¯ï¼šé”è¶…æ—¶ é˜»å¡ç­‰å¾…</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- å…ˆæŠŠè¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 5 ç§’
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> session innodb_lock_wait_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;

<span style="color:#75715e">-- ğŸ˜€ äº‹åŠ¡1ï¼š æ“ä½œç¬¬ä¸€æ¡æ•°æ®ï¼Œ å¯¹ç¬¬ä¸€æ¡æ•°æ®åŠ é”
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx-111&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
<span style="color:#75715e">-- â˜ ï¸ äº‹åŠ¡2ï¼š ä¹Ÿæ“ä½œç¬¬ä¸€æ¡æ•°æ®ï¼Œâ¤â¤â¤ å› ä¸º äº‹åŠ¡1 è¿˜æ²¡æäº¤ï¼Œè¿™é‡Œä¼šç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ â¤â¤â¤
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx-222&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
<span style="color:#75715e">-- 5 ç§’åä¼šæŠ¥ä¸‹é¢è¿™ä¸ªé”™
</span><span style="color:#75715e"></span>ERROR <span style="color:#ae81ff">1205</span> (HY000): <span style="color:#66d9ef">Lock</span> wait timeout exceeded; try restarting transaction
</code></pre></div><h3 id="-åœºæ™¯é”è¶…æ—¶-ä»…å›æ»šå½“å‰è¯­å¥">â¤ åœºæ™¯ï¼šé”è¶…æ—¶ ä»…å›æ»šå½“å‰è¯­å¥</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- å…ˆæŠŠè¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 5 ç§’
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> session innodb_lock_wait_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;

<span style="color:#75715e">-- ğŸ˜€ äº‹åŠ¡1ï¼š æ“ä½œç¬¬ä¸€æ¡æ•°æ®ï¼Œ å¯¹ç¬¬ä¸€æ¡æ•°æ®åŠ é”
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx-1&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
<span style="color:#75715e">-- â˜ ï¸ äº‹åŠ¡2ï¼š å…ˆæ›´æ–°ç¬¬äºŒæ¡æ•°æ®ï¼Œç«‹å³è¿”å›
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx-2&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
<span style="color:#75715e">-- â˜ ï¸ äº‹åŠ¡2ï¼š å†æ›´æ–°ç¬¬ä¸€æ¡æ•°æ®ï¼Œâ¤â¤â¤ é˜»å¡ç›´åˆ°è¶…æ—¶ â¤â¤â¤
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx-2&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
ERROR <span style="color:#ae81ff">1205</span> (HY000): <span style="color:#66d9ef">Lock</span> wait timeout exceeded; try restarting transaction

<span style="color:#75715e">-- ğŸ˜€ äº‹åŠ¡1ï¼š èƒ½çœ‹åˆ°è‡ªå·±åˆšåˆšæ›´æ–°çš„ç»“æœï¼Œçœ‹ä¸åˆ°äº‹åŠ¡ 2
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> T_TEST;
<span style="color:#f92672">+----+-------+-------+</span>
<span style="color:#f92672">|</span> ID <span style="color:#f92672">|</span> UNIQ  <span style="color:#f92672">|</span> NAME  <span style="color:#f92672">|</span>
<span style="color:#f92672">+----+-------+-------+</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> Kail1 <span style="color:#f92672">|</span> tx<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> Kail2 <span style="color:#f92672">|</span> tx111 <span style="color:#f92672">|</span>
<span style="color:#f92672">+----+-------+-------+</span>
<span style="color:#75715e">-- â˜ ï¸ äº‹åŠ¡2ï¼š èƒ½çœ‹åˆ°è‡ªå·±åˆšåˆšæ›´æ–°çš„ç»“æœï¼Œçœ‹ä¸åˆ°äº‹åŠ¡ 1
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> T_TEST;
<span style="color:#f92672">+----+-------+-------+</span>
<span style="color:#f92672">|</span> ID <span style="color:#f92672">|</span> UNIQ  <span style="color:#f92672">|</span> NAME  <span style="color:#f92672">|</span>
<span style="color:#f92672">+----+-------+-------+</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> Kail1 <span style="color:#f92672">|</span> tx111 <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> Kail2 <span style="color:#f92672">|</span> tx<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">+----+-------+-------+</span>

<span style="color:#75715e">-- ğŸ˜€ äº‹åŠ¡1ï¼š æäº¤äº‹åŠ¡
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> commit;
<span style="color:#75715e">-- â˜ ï¸ äº‹åŠ¡2ï¼š æäº¤äº‹åŠ¡
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> commit;

<span style="color:#75715e">-- æœ€ç»ˆæ•ˆæœï¼Œé™¤äº† äº‹åŠ¡2 é”è¶…æ—¶æ‰§è¡Œå¤±è´¥çš„è¯­å¥ï¼Œå…¶ä»–ä¸¤æ¡è¯­å¥å®é™…ä¸Šéƒ½æ‰§è¡ŒæˆåŠŸ
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> T_TEST;
<span style="color:#f92672">+----+-------+------+</span>
<span style="color:#f92672">|</span> ID <span style="color:#f92672">|</span> UNIQ  <span style="color:#f92672">|</span> NAME <span style="color:#f92672">|</span>
<span style="color:#f92672">+----+-------+------+</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> Kail1 <span style="color:#f92672">|</span> tx<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> Kail2 <span style="color:#f92672">|</span> tx<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+----+-------+------+</span>
</code></pre></div><h4 id="å°ç»“---ä»…å›æ»šå½“å‰è¯­å¥">å°ç»“ - ä»…å›æ»šå½“å‰è¯­å¥</h4>
<ul>
<li>æ­£å¦‚å®˜æ–¹æ–‡æ¡£æ‰€è¯´ï¼š <strong>å½“å‘ç”Ÿé”ç­‰å¾…è¶…æ—¶æ—¶ï¼Œå°†å›æ»šå½“å‰è¯­å¥ï¼ˆè€Œä¸æ˜¯æ•´ä¸ªäº‹åŠ¡ï¼‰</strong></li>
<li>å®é™…ä¸šåŠ¡ç³»ç»Ÿä¸­<strong>å¦‚æœå‡ºç°é”è¶…æ—¶</strong>ï¼Œ<strong>ä¸€ä¸ªäº‹åŠ¡ä¸­åªå›æ»šä¸€éƒ¨åˆ†ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´å—</strong>ï¼Ÿ</li>
<li>ç­”æ¡ˆæ˜¯ <strong>ä¸ä¼š</strong>
<ul>
<li>å› ä¸ºäº‹åŠ¡æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼å¹¶ä¸æ˜¯ä¸Šé¢åœ¨ Console ä¸­çš„æ“ä½œæ–¹å¼</li>
<li>å®é™…æ“ä½œæ–¹å¼æ˜¯ï¼š å¦‚æœ SQL æ‰§è¡ŒæˆåŠŸ <code>commit</code>ï¼Œå¦‚æœæ‰§è¡Œä¸æˆåŠŸ <code>rollback</code>ï¼Œæ•´ä¸ªäº‹åŠ¡å°±ä¼šå›æ»š</li>
<li>è€Œä¸Šé¢çš„æ“ä½œï¼Œä¸ç®¡æ˜¯å¦æˆåŠŸï¼Œå…¨éƒ½ <code>commit</code> äº†ï¼Œè¿™ç§æƒ…å†µåœ¨å®é™…ä¸šåŠ¡ç¼–ç ä¸­å¹¶ä¸å¸¸è§</li>
</ul>
</li>
<li>ä¾§é¢ä¹Ÿè¯´æ˜ï¼Œå‡å¦‚ä¸šåŠ¡ä¸­å…è®¸åœ¨é”è¶…æ—¶çš„æ—¶å€™éƒ¨åˆ†æäº¤ï¼Œå…¶å®æ˜¯å¯ä»¥å®ç°çš„</li>
<li>å½“å‰å®éªŒåœºæ™¯ä¸­çš„ <strong>â€œå›æ»šå½“å‰è¯­å¥â€</strong> å¦‚æœæ”¹æˆ <strong>â€œå½“å‰è¯­å¥æ‰§è¡Œå¤±è´¥â€</strong> å¯èƒ½ä¼šæ›´å¥½ï¼Œå‡å°‘ç†è§£ä¸Šçš„è¯¯åŒº</li>
</ul>
<h2 id="é—®é¢˜æ’æŸ¥">é—®é¢˜æ’æŸ¥</h2>
<h3 id="æŸ¥çœ‹å½“å‰ç­‰å¾…çš„äº‹åŠ¡">æŸ¥çœ‹å½“å‰ç­‰å¾…çš„äº‹åŠ¡</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> information_schema.INNODB_TRX <span style="color:#66d9ef">WHERE</span> trx_state<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;LOCK WAIT&#39;</span> <span style="color:#960050;background-color:#1e0010">\</span>G
<span style="color:#f92672">***************************</span> <span style="color:#ae81ff">1</span>. row <span style="color:#f92672">***************************</span>
                    trx_id: <span style="color:#ae81ff">21096</span>
                 trx_state: <span style="color:#66d9ef">LOCK</span> WAIT
               trx_started: <span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">27</span> <span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">04</span>:<span style="color:#ae81ff">54</span>
     trx_requested_lock_id: <span style="color:#ae81ff">21096</span>:<span style="color:#ae81ff">51</span>:<span style="color:#ae81ff">3</span>:<span style="color:#ae81ff">11</span>
          trx_wait_started: <span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">27</span> <span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">05</span>:<span style="color:#ae81ff">49</span>
                trx_weight: <span style="color:#ae81ff">2</span>
       trx_mysql_thread_id: <span style="color:#ae81ff">25</span>
                 trx_query: <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx-222&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
       trx_operation_state: <span style="color:#66d9ef">starting</span> <span style="color:#66d9ef">index</span> <span style="color:#66d9ef">read</span>
         trx_tables_in_use: <span style="color:#ae81ff">1</span>
         trx_tables_locked: <span style="color:#ae81ff">1</span>
          trx_lock_structs: <span style="color:#ae81ff">2</span>
     trx_lock_memory_bytes: <span style="color:#ae81ff">1136</span>
           trx_rows_locked: <span style="color:#ae81ff">2</span>
         trx_rows_modified: <span style="color:#ae81ff">0</span>
   trx_concurrency_tickets: <span style="color:#ae81ff">0</span>
       trx_isolation_level: <span style="color:#66d9ef">READ</span> COMMITTED
         trx_unique_checks: <span style="color:#ae81ff">1</span>
    trx_foreign_key_checks: <span style="color:#ae81ff">1</span>
trx_last_foreign_key_error: <span style="color:#66d9ef">NULL</span>
 trx_adaptive_hash_latched: <span style="color:#ae81ff">0</span>
 trx_adaptive_hash_timeout: <span style="color:#ae81ff">0</span>
          trx_is_read_only: <span style="color:#ae81ff">0</span>
trx_autocommit_non_locking: <span style="color:#ae81ff">0</span>
</code></pre></div><h3 id="lock-wait-çš„äº‹åŠ¡åœ¨ç­‰è°">LOCK WAIT çš„äº‹åŠ¡åœ¨ç­‰è°</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> information_schema.INNODB_LOCK_WAITS;
<span style="color:#f92672">+-------------------+-------------------+-----------------+------------------+</span>
<span style="color:#f92672">|</span> requesting_trx_id <span style="color:#f92672">|</span> requested_lock_id <span style="color:#f92672">|</span> blocking_trx_id <span style="color:#f92672">|</span> blocking_lock_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+-------------------+-------------------+-----------------+------------------+</span>
<span style="color:#f92672">|</span> <span style="color:#ae81ff">21096</span>             <span style="color:#f92672">|</span> <span style="color:#ae81ff">21096</span>:<span style="color:#ae81ff">51</span>:<span style="color:#ae81ff">3</span>:<span style="color:#ae81ff">11</span>     <span style="color:#f92672">|</span> <span style="color:#ae81ff">21095</span>           <span style="color:#f92672">|</span> <span style="color:#ae81ff">21095</span>:<span style="color:#ae81ff">51</span>:<span style="color:#ae81ff">3</span>:<span style="color:#ae81ff">11</span>    <span style="color:#f92672">|</span>
<span style="color:#f92672">+-------------------+-------------------+-----------------+------------------+</span>
<span style="color:#ae81ff">1</span> row <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> <span style="color:#a6e22e">warning</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01</span> sec)

<span style="color:#75715e">-- ç»¼åˆ information_schema.INNODB_LOCK_WAITS å’Œ information_schema.INNODB_TRX
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span>
	r.trx_id waiting_trx_id ,
	r.trx_mysql_thread_id waiting_thread ,
	r.trx_query waiting_query ,
	b.trx_id blocking_trx_id ,
	b.trx_mysql_thread_id blocking_thread ,
	b.trx_query blocking_query
<span style="color:#66d9ef">FROM</span>
	information_schema.INNODB_LOCK_WAITS w
<span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_TRX b <span style="color:#66d9ef">ON</span> b.trx_id <span style="color:#f92672">=</span> w.blocking_trx_id
<span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_TRX r <span style="color:#66d9ef">ON</span> r.trx_id <span style="color:#f92672">=</span> w.requesting_trx_id <span style="color:#960050;background-color:#1e0010">\</span>G
<span style="color:#f92672">***************************</span> <span style="color:#ae81ff">1</span>. row <span style="color:#f92672">***************************</span>
 waiting_trx_id: <span style="color:#ae81ff">21104</span>
 waiting_thread: <span style="color:#ae81ff">25</span>
  waiting_query: <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx-222&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
blocking_trx_id: <span style="color:#ae81ff">21102</span>
blocking_thread: <span style="color:#ae81ff">24</span>
 blocking_query: <span style="color:#66d9ef">NULL</span>
<span style="color:#ae81ff">1</span> row <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> <span style="color:#a6e22e">warning</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><h3 id="æ‰¾åˆ°é˜»å¡çš„æºå¤´">æ‰¾åˆ°é˜»å¡çš„æºå¤´</h3>
<blockquote>
<ul>
<li>
<p>å¯ä»¥æ‰¾åˆ° é˜»å¡æºå¤´ æ˜¯å“ªä¸ªäº‹åŠ¡</p>
</li>
<li>
<p>æ— æ³•æ‰¾åˆ° é˜»å¡æºå¤´ æ˜¯å“ªæ¡ SQL</p>
</li>
<li>
<p><strong>å¯ä»¥æ‰¾åˆ° é˜»å¡æºå¤´ çš„äº‹åŠ¡æ‰§è¡Œçš„ æœ€åä¸€æ¡SQL</strong></p>
<ul>
<li>
<p><a href="https://www.cnblogs.com/kerrycode/p/8948335.html">MySQL Innodbå¦‚ä½•æ‰¾å‡ºé˜»å¡äº‹åŠ¡æºå¤´SQL</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/kerrycode/p/5821413.html">ä¸ºä»€ä¹ˆæ•°æ®åº“æœ‰æ—¶å€™ä¸èƒ½å®šä½é˜»å¡ï¼ˆBlockerï¼‰æºå¤´çš„SQLè¯­å¥</a></p>
</li>
</ul>
</li>
</ul>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span>
     state.SQL_TEXT, <span style="color:#75715e">-- é˜»å¡æºå¤´ çš„äº‹åŠ¡æ‰§è¡Œçš„ æœ€åä¸€æ¡SQL
</span><span style="color:#75715e"></span>     state.DIGEST_TEXT,
     thread.PROCESSLIST_ID,
     thread.PROCESSLIST_USER, <span style="color:#75715e">-- æ¥æºç”¨æˆ·
</span><span style="color:#75715e"></span>     thread.PROCESSLIST_HOST, <span style="color:#75715e">-- æ¥æºä¸»æœº
</span><span style="color:#75715e"></span>     thread.PROCESSLIST_DB,
     tx.trx_id,
     tx.trx_state,
     tx.trx_started           <span style="color:#75715e">-- å¼€å§‹æ—¶é—´
</span><span style="color:#75715e"></span><span style="color:#66d9ef">FROM</span>
     performance_schema.events_statements_current state
<span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> performance_schema.threads thread <span style="color:#66d9ef">ON</span> state.thread_id <span style="color:#f92672">=</span> thread.thread_id
<span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_TRX tx <span style="color:#66d9ef">ON</span> thread.processlist_id <span style="color:#f92672">=</span> tx.trx_mysql_thread_id
<span style="color:#66d9ef">WHERE</span>
<span style="color:#75715e">-- æ ¹æ®äº‹åŠ¡ ID æŸ¥è¯¢
</span><span style="color:#75715e"></span>	tx.trx_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;21102&#39;</span>
<span style="color:#75715e">-- æ ¹æ® show processlist ä¸­çš„ ID æŸ¥è¯¢
</span><span style="color:#75715e">-- tx.trx_mysql_thread_id = &#39;processlist ID&#39;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span>
	tx.trx_started <span style="color:#960050;background-color:#1e0010">\</span>G
</code></pre></div><h3 id="general_log-å¼€å¯è®°å½•">general_log å¼€å¯è®°å½•</h3>
<ul>
<li><code>general_log</code> å°†æ‰€æœ‰åˆ°è¾¾ MySQL Server çš„ SQL è¯­å¥è®°å½•ä¸‹æ¥</li>
<li>ä½†æ˜¯ä¸€èˆ¬ä¸ä¼šå¼€å¯å¼€åŠŸèƒ½ï¼Œå› ä¸ºlogçš„é‡ä¼šéå¸¸åºå¤§</li>
<li>ä¸ªåˆ«æƒ…å†µä¸‹å¯èƒ½ä¼šä¸´æ—¶çš„å¼€ä¸€ä¼šå„¿ä»¥ä¾›æ’éšœä½¿ç”¨</li>
<li>ç›¸å…³å‚æ•°æœ‰
<ul>
<li><code>general_log</code> æ—¥å¿—æ˜¯å¦å¼€å¯</li>
<li><code>log_output</code> æ—¥å¿—è¾“å‡ºç±»å‹
<ul>
<li><code>FILE</code> æ—¥å¿—å†™åˆ° <code>general_log_file</code> æŒ‡å®šçš„æ–‡ä»¶ä¸­</li>
<li><code>TABLE</code> æ—¥å¿—å†™åˆ° <code>mysql.slow_log</code> è¡¨ä¸­</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%log_output%&#39;</span>;
<span style="color:#f92672">+---------------+-------+</span>
<span style="color:#f92672">|</span> Variable_name <span style="color:#f92672">|</span> Value <span style="color:#f92672">|</span>
<span style="color:#f92672">+---------------+-------+</span>
<span style="color:#f92672">|</span> log_output    <span style="color:#f92672">|</span> FILE  <span style="color:#f92672">|</span>
<span style="color:#f92672">+---------------+-------+</span>

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%general_log%&#39;</span>;
<span style="color:#f92672">+------------------+---------------------------------+</span>
<span style="color:#f92672">|</span> Variable_name    <span style="color:#f92672">|</span> Value                           <span style="color:#f92672">|</span>
<span style="color:#f92672">+------------------+---------------------------------+</span>
<span style="color:#f92672">|</span> general_log      <span style="color:#f92672">|</span> OFF                             <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> general_log_file <span style="color:#f92672">|</span> <span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>mysql<span style="color:#f92672">/</span><span style="color:#ae81ff">35</span>cb5b325ec1.log <span style="color:#f92672">|</span>
<span style="color:#f92672">+------------------+---------------------------------+</span>

<span style="color:#75715e">-- å¼€å¯ general_log
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> GLOBAL general_log <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ON&#39;</span>;

<span style="color:#75715e">-- é€šè¿‡ INNODB_TRX å’Œ INNODB_LOCK_WAITS è¡¨ï¼Œæ‰¾åˆ°é˜»å¡çš„ trx_mysql_thread_id
</span><span style="color:#75715e">-- è¿‡æ»¤å‡ºäº‹åŠ¡ä¸­æŒ‡å®šçš„ SQL
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">$</span> tail <span style="color:#f92672">-</span>fn <span style="color:#ae81ff">400</span> <span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>mysql<span style="color:#f92672">/</span><span style="color:#ae81ff">35</span>cb5b325ec1.log <span style="color:#f92672">|</span> grep <span style="color:#e6db74">&#34;{trx_mysql_thread_id}&#34;</span>
<span style="color:#66d9ef">Time</span>                              Id Command    Argument
..
<span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span>T07:<span style="color:#ae81ff">08</span>:<span style="color:#ae81ff">11</span>.<span style="color:#ae81ff">002374</span>Z        <span style="color:#ae81ff">33</span> Connect   root<span style="color:#f92672">@</span>localhost <span style="color:#66d9ef">on</span> test <span style="color:#66d9ef">using</span> Socket
<span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span>T07:<span style="color:#ae81ff">08</span>:<span style="color:#ae81ff">11</span>.<span style="color:#ae81ff">005286</span>Z        <span style="color:#ae81ff">33</span> Query     <span style="color:#66d9ef">show</span> <span style="color:#66d9ef">databases</span>
<span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span>T07:<span style="color:#ae81ff">08</span>:<span style="color:#ae81ff">11</span>.<span style="color:#ae81ff">011642</span>Z        <span style="color:#ae81ff">33</span> Query     <span style="color:#66d9ef">show</span> <span style="color:#66d9ef">tables</span>
<span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span>T07:<span style="color:#ae81ff">08</span>:<span style="color:#ae81ff">11</span>.<span style="color:#ae81ff">016498</span>Z        <span style="color:#ae81ff">33</span> Field List        T_TEST 
<span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span>T07:<span style="color:#ae81ff">08</span>:<span style="color:#ae81ff">11</span>.<span style="color:#ae81ff">019267</span>Z        <span style="color:#ae81ff">33</span> Field List        T_USER 
<span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span>T07:<span style="color:#ae81ff">08</span>:<span style="color:#ae81ff">11</span>.<span style="color:#ae81ff">028182</span>Z        <span style="color:#ae81ff">33</span> Query     <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx-112&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><h3 id="-æ›´å¿«é€Ÿçš„æ–¹æ³•">â¤ æ›´å¿«é€Ÿçš„æ–¹æ³•</h3>
<blockquote>
<ul>
<li><code>sys</code> åº“æ‰€æœ‰çš„æ•°æ®æºæ¥è‡ª <code>performance_schema</code></li>
<li>ç›®æ ‡æ˜¯æŠŠ <code>performance_schema</code> çš„æŠŠå¤æ‚åº¦é™ä½</li>
<li><code>sys</code> åº“ åŸºæœ¬ä¸Šç”± <strong>è§†å›¾</strong> å’Œ <strong>å­˜å‚¨è¿‡ç¨‹</strong> ç»„æˆ</li>
</ul>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> sys.innodb_lock_waits <span style="color:#960050;background-color:#1e0010">\</span>G
<span style="color:#f92672">***************************</span> <span style="color:#ae81ff">1</span>. row <span style="color:#f92672">***************************</span>
                wait_started: <span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span> <span style="color:#ae81ff">07</span>:<span style="color:#ae81ff">27</span>:<span style="color:#ae81ff">56</span>
                    wait_age: <span style="color:#ae81ff">00</span>:<span style="color:#ae81ff">00</span>:<span style="color:#ae81ff">24</span>
               wait_age_secs: <span style="color:#ae81ff">24</span>
                locked_table: <span style="color:#f92672">`</span>test<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>T_TEST<span style="color:#f92672">`</span>
                locked_index: <span style="color:#66d9ef">PRIMARY</span>
                 locked_type: RECORD
              waiting_trx_id: <span style="color:#ae81ff">21115</span>
         waiting_trx_started: <span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span> <span style="color:#ae81ff">07</span>:<span style="color:#ae81ff">09</span>:<span style="color:#ae81ff">09</span>
             waiting_trx_age: <span style="color:#ae81ff">00</span>:<span style="color:#ae81ff">19</span>:<span style="color:#ae81ff">11</span>
     waiting_trx_rows_locked: <span style="color:#ae81ff">3</span>
   waiting_trx_rows_modified: <span style="color:#ae81ff">0</span>
                 waiting_pid: <span style="color:#ae81ff">34</span>
               waiting_query: <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx-222&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
             waiting_lock_id: <span style="color:#ae81ff">21115</span>:<span style="color:#ae81ff">51</span>:<span style="color:#ae81ff">3</span>:<span style="color:#ae81ff">11</span>
           waiting_lock_mode: X
             blocking_trx_id: <span style="color:#ae81ff">21114</span>
                blocking_pid: <span style="color:#ae81ff">33</span>
              blocking_query: <span style="color:#66d9ef">NULL</span>
            blocking_lock_id: <span style="color:#ae81ff">21114</span>:<span style="color:#ae81ff">51</span>:<span style="color:#ae81ff">3</span>:<span style="color:#ae81ff">11</span>
          blocking_lock_mode: X
        blocking_trx_started: <span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span> <span style="color:#ae81ff">07</span>:<span style="color:#ae81ff">09</span>:<span style="color:#ae81ff">05</span>
            blocking_trx_age: <span style="color:#ae81ff">00</span>:<span style="color:#ae81ff">19</span>:<span style="color:#ae81ff">15</span>
    blocking_trx_rows_locked: <span style="color:#ae81ff">1</span>
  blocking_trx_rows_modified: <span style="color:#ae81ff">0</span>
     sql_kill_blocking_query: <span style="color:#66d9ef">KILL</span> QUERY <span style="color:#ae81ff">33</span>
sql_kill_blocking_connection: <span style="color:#66d9ef">KILL</span> <span style="color:#ae81ff">33</span>

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> sys.processlist <span style="color:#66d9ef">WHERE</span> conn_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">33</span> <span style="color:#960050;background-color:#1e0010">\</span>G
<span style="color:#f92672">***************************</span> <span style="color:#ae81ff">1</span>. row <span style="color:#f92672">***************************</span>
                thd_id: <span style="color:#ae81ff">58</span>
               conn_id: <span style="color:#ae81ff">33</span>
                  <span style="color:#66d9ef">user</span>: root<span style="color:#f92672">@</span>localhost
                    db: test
               command: Sleep
                 state: <span style="color:#66d9ef">NULL</span>
                  <span style="color:#66d9ef">time</span>: <span style="color:#ae81ff">1665</span>
     current_statement: <span style="color:#66d9ef">NULL</span>
     statement_latency: <span style="color:#66d9ef">NULL</span>
              progress: <span style="color:#66d9ef">NULL</span>
          lock_latency: <span style="color:#ae81ff">4</span>.<span style="color:#ae81ff">53</span> ms
         rows_examined: <span style="color:#ae81ff">1</span>
             rows_sent: <span style="color:#ae81ff">0</span>
         rows_affected: <span style="color:#ae81ff">0</span>
            tmp_tables: <span style="color:#ae81ff">0</span>
       tmp_disk_tables: <span style="color:#ae81ff">0</span>
             full_scan: NO
        last_statement: <span style="color:#66d9ef">UPDATE</span> T_TEST <span style="color:#66d9ef">SET</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tx-111&#39;</span> <span style="color:#66d9ef">WHERE</span> ID <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e">-- é˜»å¡æ¥æºæœ€åæ‰§è¡Œçš„SQL
</span><span style="color:#75715e"></span>last_statement_latency: <span style="color:#ae81ff">11</span>.<span style="color:#ae81ff">39</span> ms
        current_memory: <span style="color:#ae81ff">0</span> bytes
             last_wait: <span style="color:#66d9ef">NULL</span>
     last_wait_latency: <span style="color:#66d9ef">NULL</span>
                source: <span style="color:#66d9ef">NULL</span>
           trx_latency: <span style="color:#66d9ef">NULL</span>
             trx_state: <span style="color:#66d9ef">NULL</span>
        trx_autocommit: <span style="color:#66d9ef">NULL</span>
                   pid: <span style="color:#ae81ff">90</span>
          program_name: mysql
</code></pre></div><h3 id="-é”ç­‰å¾…æ—¶é—´ç»Ÿè®¡">â¤ é”ç­‰å¾…æ—¶é—´ç»Ÿè®¡</h3>
<blockquote>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/server-status-variable-reference.html">Server Status Variable Reference</a>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/server-status-variables.html#statvar_Innodb_row_lock_time_avg">Innodb_row_lock_time_avg</a></li>
</ul>
</li>
</ul>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> sys.metrics <span style="color:#66d9ef">WHERE</span> Variable_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;innodb_row_lock_%&#39;</span>;
<span style="color:#f92672">+-------------------------------+----------------+---------------+---------+</span>
<span style="color:#f92672">|</span> Variable_name                 <span style="color:#f92672">|</span> Variable_value <span style="color:#f92672">|</span> Type          <span style="color:#f92672">|</span> Enabled <span style="color:#f92672">|</span>
<span style="color:#f92672">+-------------------------------+----------------+---------------+---------+</span>
<span style="color:#f92672">|</span> innodb_row_lock_current_waits <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>              <span style="color:#f92672">|</span> Global Status <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> innodb_row_lock_time          <span style="color:#f92672">|</span> <span style="color:#ae81ff">1508173</span>        <span style="color:#f92672">|</span> Global Status <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> innodb_row_lock_time_avg      <span style="color:#f92672">|</span> <span style="color:#ae81ff">41893</span>          <span style="color:#f92672">|</span> Global Status <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> innodb_row_lock_time_max      <span style="color:#f92672">|</span> <span style="color:#ae81ff">51918</span>          <span style="color:#f92672">|</span> Global Status <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> innodb_row_lock_waits         <span style="color:#f92672">|</span> <span style="color:#ae81ff">36</span>             <span style="color:#f92672">|</span> Global Status <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span>
<span style="color:#f92672">+-------------------------------+----------------+---------------+---------+</span>

<span style="color:#75715e">-- æˆ–è€…
</span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> status <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;innodb_row_lock%&#39;</span>;
<span style="color:#f92672">+-------------------------------+---------+</span>
<span style="color:#f92672">|</span> Variable_name                 <span style="color:#f92672">|</span> Value   <span style="color:#f92672">|</span>
<span style="color:#f92672">+-------------------------------+---------+</span>
<span style="color:#f92672">|</span> Innodb_row_lock_current_waits <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Innodb_row_lock_time          <span style="color:#f92672">|</span> <span style="color:#ae81ff">1508173</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Innodb_row_lock_time_avg      <span style="color:#f92672">|</span> <span style="color:#ae81ff">41893</span>   <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Innodb_row_lock_time_max      <span style="color:#f92672">|</span> <span style="color:#ae81ff">51918</span>   <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Innodb_row_lock_waits         <span style="color:#f92672">|</span> <span style="color:#ae81ff">36</span>      <span style="color:#f92672">|</span>
<span style="color:#f92672">+-------------------------------+---------+</span>
</code></pre></div><h3 id="å°ç»“">å°ç»“</h3>
<ul>
<li><code>information_schema.INNODB_TRX</code> å½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡</li>
<li><code>information_schema.INNODB_LOCK_WAITS</code> äº‹åŠ¡çš„ é”ç­‰å¾…å…³ç³»</li>
<li><code>information_schema.INNODB_LOCKS</code>  å½“å‰å‡ºç°çš„é”</li>
<li><code>sys.innodb_lock_waits</code> è§†å›¾å¯¹ä»¥ä¸Šå‡ ä¸ªè¡¨è¿›è¡Œå’Œç»¼åˆç®€åŒ–</li>
<li><code>sys.metrics</code> è§†å›¾ å¯ç”¨æ¥æŸ¥çœ‹æŒ‡å®šæŒ‡æ ‡çš„ ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾¿äºå¯¹å‚æ•°è¿›è¡Œåˆç†çš„é…ç½®</li>
</ul>
<h2 id="å¦‚ä½•é¿å…æˆ–å‡å°‘é”è¶…æ—¶çš„æƒ…å†µ">å¦‚ä½•é¿å…æˆ–å‡å°‘é”è¶…æ—¶çš„æƒ…å†µ</h2>
<ul>
<li>äº‹åŠ¡ä¸è¦å¤ªå¤§ï¼Œä¸è¦ä¸€è‚¡è„‘çš„å¾€åŒä¸€ä¸ªäº‹åŠ¡é‡Œé¢æ–¹å¼ï¼Œè¦æ€è€ƒ
<ul>
<li>å“ªäº›æ˜¯ä¸å¿…è¦äº‹åŠ¡æ‰§è¡Œçš„</li>
<li>å“ªäº›æ­¥éª¤æ˜¯å¯ä»¥åˆ†æ­¥æ‰§è¡Œçš„</li>
</ul>
</li>
<li>å°½é‡ä¸è¦åœ¨äº‹åŠ¡ä¸­æ”¾ç½‘ç»œæ“ä½œç›¸å…³çš„ä¸œè¥¿
<ul>
<li>ç¬¬ä¸‰æ–¹çš„è¯·æ±‚çš„ç½‘ç»œè€—æ—¶é•¿ï¼Œä¼šå¯¼è‡´ä½ çš„äº‹åŠ¡é•¿æ—¶é—´æ— æ³•ç»“æŸ</li>
</ul>
</li>
<li>&hellip;</li>
</ul>
<h2 id="read-more">Read More</h2>
<ul>
<li><a href="https://www.cnblogs.com/tutar/p/5878651.html">MySQL åŠ é”å¤„ç†åˆ†æ</a></li>
<li><a href="https://ningyu1.github.io/site/post/75-mysql-lock-wait-timeout-exceeded/">MySql Lock wait timeout exceededè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</a></li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/">MySQL 5.7 Reference Manual</a> / <a href="https://dev.mysql.com/doc/refman/5.7/en/information-schema.html">INFORMATION_SCHEMA Tables</a></li>
<li><a href="https://www.cnblogs.com/kerrycode/p/8948335.html">MySQL Innodbå¦‚ä½•æ‰¾å‡ºé˜»å¡äº‹åŠ¡æºå¤´SQL</a></li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/server-status-variable-reference.html">Server Status Variable Reference</a></li>
</ul>
</article>

      
<div class="book-footer justify-between">
  
  <div>
    
    <a href="https://github.com/hello-world-example/MySQL/commit/a172f4028390a48b71891a73b708c673cae93d91" title='Last modified Mar 28, 2020 by kailbin' target="_blank" rel="noopener">
      <img src="/MySQL/svg/calendar.svg" alt="Changed" /> Mar 28, 2020
    </a>
  </div>
  
  
  <div>
    <a href="https://github.com/hello-world-example/MySQL/edit/master/HuGo/content/docs/Better/innodb_lock_wait_timeout.md" target="_blank" rel="noopener">
      <img src="/MySQL/svg/edit.svg" alt="Edit" /> Edit this page
    </a>
  </div>
  
</div>


      
    </div>

    
  

  <aside class="book-toc level-3 fixed">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#é”è¶…æ—¶lock-wait-timeout-å’Œ-æ­»é”dead-lock">é”è¶…æ—¶(Lock wait timeout) å’Œ æ­»é”(Dead Lock)</a></li>
        <li><a href="#innodb_lock_wait_timeout-å’Œ-lock_wait_timeout">innodb_lock_wait_timeout å’Œ lock_wait_timeout</a></li>
        <li><a href="#ä¿®æ”¹-innodb_lock_wait_timeout">ä¿®æ”¹ innodb_lock_wait_timeout</a></li>
      </ul>
    </li>
    <li><a href="#æµ‹è¯•åœºæ™¯">æµ‹è¯•åœºæ™¯</a>
      <ul>
        <li><a href="#æ•°æ®å‡†å¤‡">æ•°æ®å‡†å¤‡</a></li>
        <li><a href="#ä¿®æ”¹éš”ç¦»çº§åˆ«">ä¿®æ”¹éš”ç¦»çº§åˆ«</a></li>
        <li><a href="#äº‹åŠ¡æäº¤æ–¹å¼">äº‹åŠ¡æäº¤æ–¹å¼</a></li>
        <li><a href="#æµ‹è¯•å‰æ">æµ‹è¯•å‰æ</a></li>
        <li><a href="#åœºæ™¯æ­»é”-ç«‹å³å¤±è´¥">åœºæ™¯ï¼šæ­»é” ç«‹å³å¤±è´¥</a></li>
        <li><a href="#åœºæ™¯é”è¶…æ—¶-é˜»å¡ç­‰å¾…">åœºæ™¯ï¼šé”è¶…æ—¶ é˜»å¡ç­‰å¾…</a></li>
        <li><a href="#-åœºæ™¯é”è¶…æ—¶-ä»…å›æ»šå½“å‰è¯­å¥">â¤ åœºæ™¯ï¼šé”è¶…æ—¶ ä»…å›æ»šå½“å‰è¯­å¥</a></li>
      </ul>
    </li>
    <li><a href="#é—®é¢˜æ’æŸ¥">é—®é¢˜æ’æŸ¥</a>
      <ul>
        <li><a href="#æŸ¥çœ‹å½“å‰ç­‰å¾…çš„äº‹åŠ¡">æŸ¥çœ‹å½“å‰ç­‰å¾…çš„äº‹åŠ¡</a></li>
        <li><a href="#lock-wait-çš„äº‹åŠ¡åœ¨ç­‰è°">LOCK WAIT çš„äº‹åŠ¡åœ¨ç­‰è°</a></li>
        <li><a href="#æ‰¾åˆ°é˜»å¡çš„æºå¤´">æ‰¾åˆ°é˜»å¡çš„æºå¤´</a></li>
        <li><a href="#general_log-å¼€å¯è®°å½•">general_log å¼€å¯è®°å½•</a></li>
        <li><a href="#-æ›´å¿«é€Ÿçš„æ–¹æ³•">â¤ æ›´å¿«é€Ÿçš„æ–¹æ³•</a></li>
        <li><a href="#-é”ç­‰å¾…æ—¶é—´ç»Ÿè®¡">â¤ é”ç­‰å¾…æ—¶é—´ç»Ÿè®¡</a></li>
        <li><a href="#å°ç»“">å°ç»“</a></li>
      </ul>
    </li>
    <li><a href="#å¦‚ä½•é¿å…æˆ–å‡å°‘é”è¶…æ—¶çš„æƒ…å†µ">å¦‚ä½•é¿å…æˆ–å‡å°‘é”è¶…æ—¶çš„æƒ…å†µ</a></li>
    <li><a href="#read-more">Read More</a></li>
  </ul>
</nav>
  </aside>



  </main>
  
  
  
</body>

</html>
